---
title: "虚拟持仓"
description: "用于交易物品的虚拟存储，具有平均成本和盈亏跟踪。"
---

持仓是每个玩家拥有的**虚拟背包**。购买物品不会直接发送到玩家的 Minecraft 背包，而是可以先存入持仓。

## 为什么需要持仓

- 无需管理背包槽位即可交易大量物品
- 跟踪平均成本基础和盈亏 (P/L)
- 使网页交易成为可能，无需背包交互
- 减少背包已满时的物品丢失

## 典型流程

```text
购买 -> 持仓 -> 准备好时提取
出售 <- 持仓（或旧模式下的背包）
```

## 命令（典型）

```text
/market holdings
/market withdraw <material> [amount]
/market withdraw all
```

## 相关

- [配送系统](delivery) — 溢出保护
- [投资](investments) — 锁定物品并赚取年利率
- [REST API](../web-api/rest-api) — 持仓端点

## 为什么选择虚拟持仓？

| 优点 | 描述 |
|---------|-------------|
| ✅ **不丢失物品** | 背包已满？没问题——持仓存储无限* |
| ✅ **成本跟踪** | 准确知道您为每件物品支付了多少 |
| ✅ **盈亏计算** | 实时盈亏显示 |
| ✅ **网页集成** | 无缝通过浏览器交易 |
| ✅ **全局限制** | 防止经济滥用 |

*受可配置限制

---

## 持仓 GUI

从市场 GUI 访问或：

```
/market holdings
```

### 界面

```
┌─────────────────────────────────────────────────┐
│                 我的持仓                         │
│          总价值：$45,280                        │
│          总盈亏：+$3,120 (+7.4%)                │
├─────────────────────────────────────────────────┤
│                                                 │
│  [钻石] ×128         [绿宝石] ×64               │
│  平均：$95.00        平均：$48.00               │
│  现价：$100.00       现价：$52.00               │
│  盈亏：+$640 ✓       盈亏：+$256 ✓              │
│                                                 │
│  [金锭] ×256         [铁锭] ×512                │
│  平均：$10.50        平均：$5.20                │
│  现价：$9.80         现价：$5.50                │
│  盈亏：-$179 ✗       盈亏：+$154 ✓              │
│                                                 │
├─────────────────────────────────────────────────┤
│   ◀ 返回   │  📦 全部提取  │   📊 统计         │
└─────────────────────────────────────────────────┘
```

### 交互

| 操作 | 结果 |
|--------|--------|
| **左键点击**物品 | 提取全部（最多背包空间） |
| **右键点击**物品 | 提取一组（64 或最大） |
| **全部提取**按钮 | 领取所有能放下的 |
| **统计**按钮 | 查看详细投资组合统计 |

---

## 命令

### 查看持仓

```
/market holdings
```

聊天输出：
```
=== 您的持仓 ===
钻石：128 (平均：$95.00, 盈亏：+$640.00)
绿宝石：64 (平均：$48.00, 盈亏：+$256.00)
金锭：256 (平均：$10.50, 盈亏：-$179.20)
---
总物品：448
总价值：$45,280.00
总盈亏：+$716.80 (+1.6%)
```

### 提取物品

```
/market withdraw <item>           # 该物品全部
/market withdraw <item> <amount>  # 特定数量
/market withdraw all              # 所有物品
```

示例：
```
/market withdraw diamond
/market withdraw emerald 32
/market withdraw all
```

---

## 成本基础跟踪

系统跟踪您每种材料的**平均成本**：

### 示例

1. 以每个 $100 购买 64 个钻石 = $6,400
2. 再以每个 $110 购买 64 个 = $7,040
3. **平均成本**：($6,400 + $7,040) / 128 = **每个钻石 $104.69**

当您提取时：
- 应用先进先出 (FIFO)
- 成本基础相应调整

---

## 盈亏计算

盈亏实时计算：

```
盈亏 = (当前价格 - 平均成本) × 数量
盈亏% = ((当前价格 / 平均成本) - 1) × 100
```

### 示例

- 持有：128 个钻石
- 平均成本：$95.00
- 当前价格：$100.00

```
盈亏 = ($100 - $95) × 128 = +$640
盈亏% = ((100 / 95) - 1) × 100 = +5.26%
```

---

## 限制

持仓有可配置的限制以防止滥用：

```yaml
holdings:
  max-per-player: 10000           # 总物品数
  max-materials-per-player: 100   # 不同材料数
```

### 达到限制会怎样？

- **达到最大物品数** → 溢出进入配送队列
- **达到最大材料数** → 无法购买新的材料类型

检查您的限制：
```
/market holdings stats
```

---

## 配置

```yaml
holdings:
  # 启用/禁用持仓系统
  enabled: true
  
  # 玩家可持有的最大物品总数
  max-per-player: 10000
  
  # 每个玩家的最大不同材料数
  max-materials-per-player: 100
  
  # 模式：VIRTUAL（新）或 LEGACY（旧直接到背包）
  mode: VIRTUAL
```

### 模式选项

| 模式 | 行为 |
|------|----------|
| **VIRTUAL** | 物品进入持仓，手动提取 |
| **LEGACY** | 物品直接进入背包（旧行为） |

---

## 网页仪表盘集成

持仓与网页仪表盘无缝配合：

### 在线查看持仓

```
GET /api/holdings
```

### 从浏览器提取

点击任何持仓旁边的 📤 按钮，或使用"全部提取"。

更改立即与游戏内同步。

---

## 从旧版迁移

如果从旧版本升级：

1. 现有背包物品保留在背包中
2. 新购买进入持仓
3. 无需数据迁移

使用旧行为：
```yaml
holdings:
  mode: LEGACY
```

---

## 技巧

<Tip>
**持有获利**  
在需要物品之前不要提取。持仓实时显示您的盈亏！
</Tip>

<Info>
**网页交易**  
对于批量提取，使用网页仪表盘。管理大型投资组合更快。
</Info>

<Warning>
**背包空间**  
提取命令会检查背包空间。批量提取前清空背包。
</Warning>

---

## 相关页面

- [市场 GUI](market-gui) — GUI 中的持仓面板
- [配送系统](delivery) — 溢出处理
- [REST API](../web-api/rest-api) — 持仓端点
