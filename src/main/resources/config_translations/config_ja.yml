# ═══════════════════════════════════════════════════════════════════════════════
# The Endex - 動的市場経済プラグイン設定
# ═══════════════════════════════════════════════════════════════════════════════
# 編集後、/endex reload を実行（管理者権限が必要）するか、サーバーを再起動してください。
#
# ═══════════════════════════════════════════════════════════════════════════════
# 🚀 リソース使用量最小化のための最適化済み (v1.5.8-JAN80235)
# ═══════════════════════════════════════════════════════════════════════════════
# この設定は、デフォルトで「低リソース使用」向けに事前最適化されています。
# 小〜中規模のサーバー、またはパフォーマンスへの影響を最小限に抑えたいサーバーに最適です。
#
# 適用済みの主な最適化:
#   ✓ ワールドストレージのスキャン: 無効 (CPU負荷を大幅に削減)
#   ✓ 更新ごとの保存: 無効 (ディスクI/Oを削減)
#   ✓ 長めの更新間隔 (計算頻度を減少)
#   ✓ SQLiteストレージ: 有効 (YAMLよりも高速)
#   ✓ チャンクキャッシュ: 有効 (ワールドスキャン使用時)
#   ✓ 最小限の履歴の長さ (メモリ使用量を削減)
#
# フル機能（リソース消費増）を有効にする場合:
#   - price-world-storage.enabled を true に設定 (動的な希少性価格)
#   - update-interval-seconds を 60 に短縮 (市場の反応性を向上)
#   - history-length を 120 に増加 (より詳細なチャート)
#
# ═══════════════════════════════════════════════════════════════════════════════
# パフォーマンスガイド
# ═══════════════════════════════════════════════════════════════════════════════
# 各オプションにはパフォーマンスへの影響がラベル付けされています:
#   [PERF: MINIMAL]  - 無視できる影響。どのサーバーでも安全です。
#   [PERF: LOW]      - CPU/メモリ使用量低。すべてのサーバーで安全です。
#   [PERF: MEDIUM]   - 中程度の影響。サーバー規模に応じて調整してください。
#   [PERF: HIGH]     - 大きな影響。大規模サーバー（プレイヤー50人以上）向けに最適化が必要。
#   [PERF: CRITICAL] - 高負荷。慎重な調整を推奨。
#
# 大規模サーバーへのヒント:
#   - update-interval-seconds を増やす (300-600)
#   - price-world-storage を無効にするか scanned-worlds を制限する
#   - world-storage の chunk-caching を有効にする
#   - history-length を 30-50 に減らす
#   - YAMLの代わりに SQLite ストレージを使用する
# ═══════════════════════════════════════════════════════════════════════════════

# 内部バージョン（変更検知用）。変更しないでください。
config-version: 1

# ───────────────────────────────────────────────────────────────────────────────
# 言語設定
# ───────────────────────────────────────────────────────────────────────────────
language:
  locale: ja

# ───────────────────────────────────────────────────────────────────────────────
# 価格更新サイクル [PERF: MEDIUM]
# ───────────────────────────────────────────────────────────────────────────────
# 市場が需要と供給に基づいて価格を再計算する頻度（秒）。
# 推奨: 小〜中規模は 60s、大規模で混雑したサーバーは 120-300s。
update-interval-seconds: 60

# ───────────────────────────────────────────────────────────────────────────────
# 価格感度 [PERF: MINIMAL]
# ───────────────────────────────────────────────────────────────────────────────
# 需要と供給の不均衡が価格に与える影響の強さを制御します。
# 推奨: 0.05 (純需要1単位につき5%の変化)
price-sensitivity: 0.05

# ───────────────────────────────────────────────────────────────────────────────
# 履歴の追跡 [PERF: LOW]
# ───────────────────────────────────────────────────────────────────────────────
# チャート用に保存する過去の価格データの数。
# 推奨: スパークライン用は 5-10、詳細なウェブチャート用は 50-120。
history-length: 5

# ───────────────────────────────────────────────────────────────────────────────
# 自動保存とバックアップ [PERF: LOW to MEDIUM]
# ───────────────────────────────────────────────────────────────────────────────
# 市場データをディスクに保存する頻度（分）。
autosave-minutes: 5

# 更新ごとに market.yml を即座に保存する（YAMLモードのみ）。
# [PERF: 有効な場合 HIGH]
save-on-each-update: false

# ───────────────────────────────────────────────────────────────────────────────
# データストレージモード [PERF: MEDIUM to HIGH]
# ───────────────────────────────────────────────────────────────────────────────
# SQLite (sqlite: true) を強く推奨します。YAMLより5〜10倍高速です。
storage:
  sqlite: true

# ───────────────────────────────────────────────────────────────────────────────
# 価格の平滑化とボラティリティ保護 [PERF: MINIMAL]
# ───────────────────────────────────────────────────────────────────────────────
price-smoothing:
  enabled: true
  # EMA Alpha (0.0 - 1.0): 価格の適応速度。推奨: 0.3
  ema-alpha: 0.3
  # 1サイクルあたりの最大価格変動率（%）。推奨: 15.0
  max-change-percent: 15.0

# ───────────────────────────────────────────────────────────────────────────────
# インフレ / デフレシステム [PERF: MINIMAL]
# ───────────────────────────────────────────────────────────────────────────────
inflation:
  enabled: false
  # サイクルごとの変化率。正 = インフレ、負 = デフレ。
  rate-per-cycle: 0.01
  category-rates:
    ores: 0.02
    food: 0.0
    building: 0.01
    mob-drops: 0.01
  # プレイヤーがオンラインの場合のみ適用。
  require-players: true
  # 基本価格からの最大乖離率（%）。
  max-deviation-percent: 200.0

# ───────────────────────────────────────────────────────────────────────────────
# 平均回帰 (不正操作防止) [PERF: MINIMAL]
# ───────────────────────────────────────────────────────────────────────────────
# 活動がない場合、価格を徐々に基本価格に戻します。
price-reversion:
  enabled: true
  # 1サイクルで埋める価格差の割合。推奨: 2.0%
  rate-percent-per-cycle: 2.0
  # そのサイクルで取引がなかった場合のみ適用。
  only-when-idle: true

# ───────────────────────────────────────────────────────────────────────────────
# インベントリによる価格影響 [PERF: LOW]
# ───────────────────────────────────────────────────────────────────────────────
# オンラインプレイヤーの所持品に基づいて価格を調整します。
price-inventory:
  enabled: false
  sensitivity: 0.02
  # プレイヤーごとの基準量。これを超えると価格が下がり、下回ると上がります。
  per-player-baseline: 64
  max-impact-percent: 10.0

# ───────────────────────────────────────────────────────────────────────────────
# ワールドストレージによる価格影響 [PERF: HIGH to CRITICAL]
# ───────────────────────────────────────────────────────────────────────────────
# ロードされたチャンク内のチェストや樽などをスキャンします。
# ⚠️ 最もリソースを消費する機能です。
price-world-storage:
  enabled: false
  scan-interval-seconds: 300
  sensitivity: 0.01
  global-baseline: 1000
  max-impact-percent: 5.0
  # 1サーバーチックあたりに処理するチャンク数。推奨: 50
  chunks-per-tick: 50
  containers:
    chests: true
    barrels: true
    shulker-boxes: true
    hoppers: false
    droppers: false
    dispensers: false
    furnaces: false
    brewing-stands: false
  scan-shulker-contents: true
  excluded-worlds: []
  
  # 不正操作防止
  anti-manipulation:
    per-chunk-item-cap: 10000
    per-material-chunk-cap: 5000
    min-tps: 18.0
    log-suspicious: true

  # スマートキャッシュ [PERF: CRITICAL - パフォーマンス向上のため有効化推奨]
  cache:
    enabled: true
    chunk-expiry-seconds: 600
    full-refresh-cycles: 5
    persist-to-disk: true

# ───────────────────────────────────────────────────────────────────────────────
# 初期市場セットアップ
# ───────────────────────────────────────────────────────────────────────────────
# データベースが存在しない場合のみ適用されます。
seed-all-materials: false
include-default-important-items: true

# ───────────────────────────────────────────────────────────────────────────────
# 取引税 [PERF: MINIMAL]
# ───────────────────────────────────────────────────────────────────────────────
# すべての売買に課される税率（通貨回収用）。
transaction-tax-percent: 0.0

# ───────────────────────────────────────────────────────────────────────────────
# 売買スプレッド (裁定取引防止)
# ───────────────────────────────────────────────────────────────────────────────
# 購入価格と売却価格に差を設け、悪用を防ぎます。
spread:
  enabled: true
  # 購入時の上乗せ率 (%)
  buy-markup-percent: 3.0
  # 売却時の値引き率 (%)
  sell-markdown-percent: 3.0

# ───────────────────────────────────────────────────────────────────────────────
# 売却クールダウン [PERF: NEGLIGIBLE]
# ───────────────────────────────────────────────────────────────────────────────
# 価格操作のための即時売買を防ぎます。
anti-arbitrage:
  sell-cooldown:
    enabled: true
    duration-seconds: 60

# ───────────────────────────────────────────────────────────────────────────────
# アイテムブラックリスト
# ───────────────────────────────────────────────────────────────────────────────
# 市場に決して表示されない材料 (例: [BEDROCK, BARRIER])。
blacklist-items: []

# ───────────────────────────────────────────────────────────────────────────────
# 仮想所持金システム (HOLDINGS) [PERF: LOW]
# ───────────────────────────────────────────────────────────────────────────────
# 仮想的な保管場所。購入品はここに入り、後で物理的に引き出します。
holdings:
  enabled: true
  max-total-per-player: 100000
  auto-withdraw-on-login: false

# ───────────────────────────────────────────────────────────────────────────────
# 仮想配送システム (非推奨 - holdings を使用してください)
# ───────────────────────────────────────────────────────────────────────────────
delivery:
  enabled: true
  auto-claim-on-login: false
  max-pending-per-player: 10000

# ───────────────────────────────────────────────────────────────────────────────
# 市場GUIのカスタマイズ
# ───────────────────────────────────────────────────────────────────────────────
gui:
  # アイテムをシフトクリックした際にスパークラインチャートを表示。
  details-chart: true

# ───────────────────────────────────────────────────────────────────────────────
# ショップシステムモード
# ───────────────────────────────────────────────────────────────────────────────
# DEFAULT = スクロール可能なリスト / CUSTOM = カテゴリベース。
shop:
  mode: DEFAULT
  main-shop: main
  command: shop
  custom:
    items-per-page: 45
    show-back-button: true
    back-button-slot: 49
    show-pagination: true
    prev-page-slot: 48
    next-page-slot: 50
    show-amount-button: true
    amount-button-slot: 45
    admin-edit: true
    # GUI上の価格表示フォーマット
    price-lore:
      - "&7"
      - "&a左クリック: &f購入: &6$%buy_price%"
      - "&c右クリック: &f売却: &6$%sell_price%"
      - "&7"
      - "&8在庫: %stock% | 需要: %demand%"
    admin-lore: "&e⚡ シフトクリック: アイテム編集 (管理者)"

# ───────────────────────────────────────────────────────────────────────────────
# 投資システム [PERF: LOW]
# ───────────────────────────────────────────────────────────────────────────────
# プレイヤーはアイテムに投資し、複利を得ることができます。
investments:
  enabled: true
  # 年換算利回り (APR)。推奨: 5.0
  apr-percent: 5.0

# ───────────────────────────────────────────────────────────────────────────────
# 履歴のエクスポート (分析用)
# ───────────────────────────────────────────────────────────────────────────────
history-export:
  enabled: true
  folder: history

# ───────────────────────────────────────────────────────────────────────────────
# リソース追跡
# ───────────────────────────────────────────────────────────────────────────────
tracking:
  resources:
    enabled: true
    # 回収したリソースを自動的に市場の「供給」に追加しますか？
    # ⚠️ 注意: 大幅なデフレを招く可能性があります。推奨: false。
    apply-to-market: false
    sources:
      block-break: true
      mob-drops: true
      fishing: true

# ───────────────────────────────────────────────────────────────────────────────
# 市場イベント
# ───────────────────────────────────────────────────────────────────────────────
events:
  # 重複する倍率の上限。
  multiplier-cap: 10.0

# ═══════════════════════════════════════════════════════════════════════════════
# ウェブダッシュボード設定 [PERF: LOW to MEDIUM]
# ═══════════════════════════════════════════════════════════════════════════════
web:
  enabled: true
  # 本番環境ではリバースプロキシ（nginx等）を使用して 127.0.0.1 を推奨。
  host: 127.0.0.1
  port: 3434
  session-duration-hours: 2
  
  # 応答の圧縮 [PERF: LOW - 帯域幅を節約]
  compression:
    enabled: true
    level: 4

  # リアルタイム更新メソッド
  poll-ms: 1000
  history-limit: 120
  sse:
    enabled: false
  websocket:
    enabled: true
  
  # APIレート制限 (セキュリティ)
  rate-limit:
    enabled: true
    requests: 30
    per-seconds: 10
    exempt-ui: true
  
  # 権限とロール
  roles:
    default: TRADER
    trader-permission: endex.web.trade
    admin-view-permission: endex.web.admin
  
  # ウェブ上のマイクラアイコン
  icons:
    enabled: false
    source: ""
  
  # アドオン統合
  addons: []
  
  # カスタムWebUIの上書き
  custom:
    enabled: false
    root: webui
    reload: false
    export-default: true
  
  # 所持品API
  holdings:
    inventory:
      enabled: true
      include-enderchest: false
      cache-seconds: 15

# ═══════════════════════════════════════════════════════════════════════════════
# ログとデバッグ [PERF: LOW - 詳細モードはI/Oが増加]
# ═══════════════════════════════════════════════════════════════════════════════
logging:
  # トラブルシューティング時のみ有効にしてください。ログファイルが肥大化します。
  verbose: false

# ═══════════════════════════════════════════════════════════════════════════════
# アップデートチェッカー
# ═══════════════════════════════════════════════════════════════════════════════
update-checker:
  enabled: true
  notify-ops: true

# ═══════════════════════════════════════════════════════════════════════════════
# 設定終了
# ═══════════════════════════════════════════════════════════════════════════════