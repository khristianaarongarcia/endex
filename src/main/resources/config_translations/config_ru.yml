# ═══════════════════════════════════════════════════════════════════════════════
# The Endex - Конфигурация плагина динамической рыночной экономики
# ═══════════════════════════════════════════════════════════════════════════════
# После редактирования выполните /endex reload (нужны права админа) или перезагрузите сервер.
#
# ═══════════════════════════════════════════════════════════════════════════════
# 🚀 ОПТИМИЗИРОВАНО ДЛЯ МИНИМАЛЬНОГО ПОТРЕБЛЕНИЯ РЕСУРСОВ (v1.5.8-JAN80235)
# ═══════════════════════════════════════════════════════════════════════════════
# По умолчанию эта конфигурация оптимизирована для НИЗКОЙ НАГРУЗКИ.
# Идеально для малых и средних серверов или тех, кто ценит производительность.
#
# ПРИМЕНЕННЫЕ ОПТИМИЗАЦИИ:
#   ✓ Сканирование хранилищ в мире ОТКЛЮЧЕНО (экономия CPU)
#   ✓ Сохранение при каждом обновлении ОТКЛЮЧЕНО (снижение нагрузки на диск)
#   ✓ Увеличенные интервалы обновления (реже производятся расчеты)
#   ✓ Хранилище SQLite включено (быстрее, чем YAML)
#   ✓ Кэширование чанков включено (для сканирования мира)
#   ✓ Минимальная длина истории (экономия оперативной памяти)
#
# ДЛЯ ВКЛЮЧЕНИЯ ПОЛНЫХ ФУНКЦИЙ (потребует больше ресурсов):
#   - Установите price-world-storage.enabled: true (динамические цены на дефицит)
#   - Уменьшите update-interval-seconds до 60 (рынок станет быстрее реагировать)
#   - Увеличьте history-length до 120 (более детальные графики)
#
# ═══════════════════════════════════════════════════════════════════════════════
# ГАЙД ПО ПРОИЗВОДИТЕЛЬНОСТИ (PERFORMANCE GUIDE)
# ═══════════════════════════════════════════════════════════════════════════════
# Каждая опция помечена уровнем влияния на ресурсы:
#   [PERF: MINIMAL]  - Незначительное влияние, безопасно для любого сервера.
#   [PERF: LOW]      - Низкое потребление CPU/RAM, безопасно для всех.
#   [PERF: MEDIUM]   - Умеренное влияние, настраивайте под размер сервера.
#   [PERF: HIGH]     - Значительное влияние, оптимизируйте для серверов 50+ игроков.
#   [PERF: CRITICAL] - Высокая нагрузка, требуется тщательная настройка.
#
# Советы для крупных серверов:
#   - Увеличьте update-interval-seconds (300-600)
#   - Отключите price-world-storage или ограничьте scanned-worlds
#   - Включите chunk-caching в world-storage
#   - Уменьшите history-length до 30-50
#   - Используйте хранилище SQLite вместо YAML
# ═══════════════════════════════════════════════════════════════════════════════

# Внутренняя версия для обнаружения изменений. НЕ МЕНЯТЬ.
config-version: 1

# ───────────────────────────────────────────────────────────────────────────────
# НАСТРОЙКИ ЯЗЫКА
# ───────────────────────────────────────────────────────────────────────────────
language:
  locale: ru

# ───────────────────────────────────────────────────────────────────────────────
# ЦИКЛ ОБНОВЛЕНИЯ ЦЕН [PERF: MEDIUM]
# ───────────────────────────────────────────────────────────────────────────────
# Частота (в секундах) пересчета цен рынком на основе спроса и предложения.
# Рекомендуется: 60 для малых/средних, 120-300 для крупных серверов.
update-interval-seconds: 60

# ───────────────────────────────────────────────────────────────────────────────
# ЧУВСТВИТЕЛЬНОСТЬ ЦЕН [PERF: MINIMAL]
# ───────────────────────────────────────────────────────────────────────────────
# Определяет, насколько сильно дисбаланс спроса/предложения влияет на цены.
# Рекомендуется: 0.05 (изменение 5% на единицу чистого спроса)
price-sensitivity: 0.05

# ───────────────────────────────────────────────────────────────────────────────
# ИСТОРИЯ ЦЕН [PERF: LOW]
# ───────────────────────────────────────────────────────────────────────────────
# Количество прошлых значений цены для хранения (нужно для графиков).
# Рекомендуется: 5-10 для мини-графиков, 50-120 для детальных веб-чартов.
history-length: 5

# ───────────────────────────────────────────────────────────────────────────────
# АВТОСОХРАНЕНИЕ И БЭКАП [PERF: LOW to MEDIUM]
# ───────────────────────────────────────────────────────────────────────────────
# Частота (в минутах) сохранения данных рынка на диск.
autosave-minutes: 5

# Сохранять market.yml немедленно после КАЖДОГО обновления цен (Только для YAML).
# [PERF: HIGH если включено]
save-on-each-update: false

# ───────────────────────────────────────────────────────────────────────────────
# РЕЖИМ ХРАНЕНИЯ ДАННЫХ [PERF: MEDIUM to HIGH]
# ───────────────────────────────────────────────────────────────────────────────
# SQLite (sqlite: true) КРАЙНЕ РЕКОМЕНДУЕТСЯ: в 5-10 раз быстрее, чем YAML.
storage:
  sqlite: true

# ───────────────────────────────────────────────────────────────────────────────
# СГЛАЖИВАНИЕ ЦЕН И ЗАЩИТА ОТ ВОЛАТИЛЬНОСТИ [PERF: MINIMAL]
# ───────────────────────────────────────────────────────────────────────────────
price-smoothing:
  enabled: true
  # Фактор EMA (0.0 - 1.0): Скорость адаптации цен. Рекомендуется: 0.3
  ema-alpha: 0.3
  # Максимальное изменение цены за один цикл (%). Рекомендуется: 15.0
  max-change-percent: 15.0

# ───────────────────────────────────────────────────────────────────────────────
# СИСТЕМА ИНФЛЯЦИИ / ДЕФЛЯЦИИ [PERF: MINIMAL]
# ───────────────────────────────────────────────────────────────────────────────
inflation:
  enabled: false
  # Темп изменения за цикл. Положительный = Инфляция, Отрицательный = Дефляция.
  rate-per-cycle: 0.01
  category-rates:
    ores: 0.02
    food: 0.0
    building: 0.01
    mob-drops: 0.01
  # Применять только когда игроки в сети.
  require-players: true
  # Максимальное отклонение от базовой цены (%).
  max-deviation-percent: 200.0

# ───────────────────────────────────────────────────────────────────────────────
# ВОЗВРАТ К СРЕДНЕМУ (Защита от манипуляций) [PERF: MINIMAL]
# ───────────────────────────────────────────────────────────────────────────────
# Постепенно возвращает цены к базовым, если нет торговой активности.
price-reversion:
  enabled: true
  # Процент разрыва, который сокращается за цикл. Рекомендуется: 2.0%
  rate-percent-per-cycle: 2.0
  # Применять только если за цикл НЕ было сделок.
  only-when-idle: true

# ───────────────────────────────────────────────────────────────────────────────
# ВЛИЯНИЕ ИНВЕНТАРЯ НА ЦЕНЫ [PERF: LOW]
# ───────────────────────────────────────────────────────────────────────────────
# Регулирует цены на основе предметов в инвентарях игроков онлайн.
price-inventory:
  enabled: false
  sensitivity: 0.02
  # Базовое количество на игрока. Выше = цена ПАДАЕТ, ниже = цена РАСТЕТ.
  per-player-baseline: 64
  max-impact-percent: 10.0

# ───────────────────────────────────────────────────────────────────────────────
# ВЛИЯНИЕ ХРАНИЛИЩ МИРА [PERF: HIGH to CRITICAL]
# ───────────────────────────────────────────────────────────────────────────────
# Сканирует сундуки, бочки и т.д. в загруженных чанках.
# ⚠️ САМАЯ ЗАТРАТНАЯ ФУНКЦИЯ.
price-world-storage:
  enabled: false
  scan-interval-seconds: 300
  sensitivity: 0.01
  global-baseline: 1000
  max-impact-percent: 5.0
  # Кол-во чанков, обрабатываемых за один тик сервера. Рекомендуется: 50.
  chunks-per-tick: 50
  containers:
    chests: true
    barrels: true
    shulker-boxes: true
    hoppers: false
    droppers: false
    dispensers: false
    furnaces: false
    brewing-stands: false
  scan-shulker-contents: true
  excluded-worlds: []
  
  # ЗАЩИТА ОТ МАНИПУЛЯЦИЙ
  anti-manipulation:
    per-chunk-item-cap: 10000
    per-material-chunk-cap: 5000
    min-tps: 18.0
    log-suspicious: true

  # УМНЫЙ КЭШ [PERF: CRITICAL - Включите для производительности!]
  cache:
    enabled: true
    chunk-expiry-seconds: 600
    full-refresh-cycles: 5
    persist-to-disk: true

# ───────────────────────────────────────────────────────────────────────────────
# НАЧАЛЬНАЯ НАСТРОЙКА РЫНКА
# ───────────────────────────────────────────────────────────────────────────────
# Применяется только если база данных пуста.
seed-all-materials: false
include-default-important-items: true

# ───────────────────────────────────────────────────────────────────────────────
# НАЛОГ НА ТРАНЗАКЦИИ [PERF: MINIMAL]
# ───────────────────────────────────────────────────────────────────────────────
# Процент налога со всех покупок и продаж (вывод валюты из экономики).
transaction-tax-percent: 0.0

# ───────────────────────────────────────────────────────────────────────────────
# СПРЕД ПОКУПКИ/ПРОДАЖИ (Защита от арбитража)
# ───────────────────────────────────────────────────────────────────────────────
# Создает разрыв между ценой покупки и продажи для предотвращения абузов.
spread:
  enabled: true
  # Игроки платят на X% БОЛЬШЕ при покупке.
  buy-markup-percent: 3.0
  # Игроки получают на X% МЕНЬШЕ при продаже.
  sell-markdown-percent: 3.0

# ───────────────────────────────────────────────────────────────────────────────
# КД НА ПРОДАЖУ [PERF: NEGLIGIBLE]
# ───────────────────────────────────────────────────────────────────────────────
# Предотвращает мгновенную куплю-продажу для манипуляции ценой.
anti-arbitrage:
  sell-cooldown:
    enabled: true
    duration-seconds: 60

# ───────────────────────────────────────────────────────────────────────────────
# ЧЕРНЫЙ СПИСОК ПРЕДМЕТОВ
# ───────────────────────────────────────────────────────────────────────────────
# Материалы, которые НИКОГДА не появятся на рынке (напр. [BEDROCK, BARRIER]).
blacklist-items: []

# ───────────────────────────────────────────────────────────────────────────────
# СИСТЕМА ВИРТУАЛЬНЫХ АКТИВОВ (HOLDINGS) [PERF: LOW]
# ───────────────────────────────────────────────────────────────────────────────
# Виртуальное хранилище. Покупки попадают сюда, затем забираются физически.
holdings:
  enabled: true
  max-total-per-player: 100000
  auto-withdraw-on-login: false

# ───────────────────────────────────────────────────────────────────────────────
# СИСТЕМА ДОСТАВКИ (УСТАРЕЛО - используйте holdings)
# ───────────────────────────────────────────────────────────────────────────────
delivery:
  enabled: true
  auto-claim-on-login: false
  max-pending-per-player: 10000

# ───────────────────────────────────────────────────────────────────────────────
# КАСТОМИЗАЦИЯ GUI РЫНКА
# ───────────────────────────────────────────────────────────────────────────────
gui:
  # Показ графика при Shift+Click на предмет.
  details-chart: true

# ───────────────────────────────────────────────────────────────────────────────
# РЕЖИМ СИСТЕМЫ МАГАЗИНА
# ───────────────────────────────────────────────────────────────────────────────
# DEFAULT = Прокручиваемый список / CUSTOM = Магазин по категориям.
shop:
  mode: DEFAULT
  main-shop: main
  command: shop
  custom:
    items-per-page: 45
    show-back-button: true
    back-button-slot: 49
    show-pagination: true
    prev-page-slot: 48
    next-page-slot: 50
    show-amount-button: true
    amount-button-slot: 45
    admin-edit: true
    # Формат описания цены в меню.
    price-lore:
      - "&7"
      - "&aЛКМ: &fКупить: &6$%buy_price%"
      - "&cПКМ: &fПродать: &6$%sell_price%"
      - "&7"
      - "&8Запас: %stock% | Спрос: %demand%"
    admin-lore: "&e⚡ Shift+Клик: Редактировать предмет (Админ)"

# ───────────────────────────────────────────────────────────────────────────────
# СИСТЕМА ИНВЕСТИЦИЙ [PERF: LOW]
# ───────────────────────────────────────────────────────────────────────────────
# Игроки могут инвестировать в предметы для получения сложного процента.
investments:
  enabled: true
  # Годовая процентная ставка (APR). Рекомендуется: 5.0
  apr-percent: 5.0

# ───────────────────────────────────────────────────────────────────────────────
# ЭКСПОРТ ИСТОРИИ (АНАЛИТИКА)
# ───────────────────────────────────────────────────────────────────────────────
history-export:
  enabled: true
  folder: history

# ───────────────────────────────────────────────────────────────────────────────
# ОТСЛЕЖИВАНИЕ РЕСУРСОВ
# ───────────────────────────────────────────────────────────────────────────────
tracking:
  resources:
    enabled: true
    # Автоматически добавлять добытые ресурсы в ПРЕДЛОЖЕНИЕ рынка?
    # ⚠️ ВНИМАНИЕ: Может вызвать массовую дефляцию. Рекомендуется: false.
    apply-to-market: false
    sources:
      block-break: true
      mob-drops: true
      fishing: true

# ───────────────────────────────────────────────────────────────────────────────
# СОБЫТИЯ РЫНКА
# ───────────────────────────────────────────────────────────────────────────────
events:
  # Максимальный лимит суммируемых множителей.
  multiplier-cap: 10.0

# ═══════════════════════════════════════════════════════════════════════════════
# НАСТРОЙКИ ВЕБ-ПАНЕЛИ [PERF: LOW to MEDIUM]
# ═══════════════════════════════════════════════════════════════════════════════
web:
  enabled: true
  # Используйте 127.0.0.1 с прокси (nginx) в продакшене.
  host: 127.0.0.1
  port: 3434
  session-duration-hours: 2
  
  # СЖАТИЕ ОТВЕТОВ [PERF: LOW - экономит трафик]
  compression:
    enabled: true
    level: 4

  # МЕТОДЫ ОБНОВЛЕНИЯ В РЕАЛЬНОМ ВРЕМЕНИ
  poll-ms: 1000
  history-limit: 120
  sse:
    enabled: false
  websocket:
    enabled: true
  
  # ОГРАНИЧЕНИЕ ЗАПРОСОВ API (Безопасность)
  rate-limit:
    enabled: true
    requests: 30
    per-seconds: 10
    exempt-ui: true
  
  # РОЛИ И ПРАВА
  roles:
    default: TRADER
    trader-permission: endex.web.trade
    admin-view-permission: endex.web.admin
  
  # ИКОНКИ МАЙНКРАФТ В ВЕБЕ
  icons:
    enabled: false
    source: ""
  
  # ИНТЕГРАЦИЯ АДДОНОВ
  addons: []
  
  # ПЕРЕОПРЕДЕЛЕНИЕ WEB-ИНТЕРФЕЙСА
  custom:
    enabled: false
    root: webui
    reload: false
    export-default: true
  
  # API ВЛАДЕНИЙ В ИНВЕНТАРЕ
  holdings:
    inventory:
      enabled: true
      include-enderchest: false
      cache-seconds: 15

# ═══════════════════════════════════════════════════════════════════════════════
# ЛОГИ И ОТЛАДКА [PERF: LOW - verbose увеличивает нагрузку на диск]
# ═══════════════════════════════════════════════════════════════════════════════
logging:
  # Включайте только для поиска проблем. Сильно увеличивает размер логов.
  verbose: false

# ═══════════════════════════════════════════════════════════════════════════════
# ПРОВЕРКА ОБНОВЛЕНИЙ
# ═══════════════════════════════════════════════════════════════════════════════
update-checker:
  enabled: true
  notify-ops: true

# ═══════════════════════════════════════════════════════════════════════════════
# КОНЕЦ КОНФИГУРАЦИИ
# ═══════════════════════════════════════════════════════════════════════════════