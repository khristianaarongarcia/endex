# The Endex - Core Configuration
# After editing, run /endex reload (admin) or restart your server.

# Config version: incremented when breaking config changes occur.
# If this differs from what the plugin expects, a warning will be logged.
config-version: 1

# Price update interval (seconds)
update-interval-seconds: 60

# Price sensitivity in formula: new = old * (1 + (demand - supply) * sensitivity)
price-sensitivity: 0.05

# How many history points to keep per item
history-length: 5

# Autosave and backup frequency (minutes)
autosave-minutes: 5

# Save market.yml immediately after each price update (YAML mode only; may increase disk IO)
save-on-each-update: true

## Storage
# When true, use SQLite (market.db) instead of YAML for items/history.
# First run with SQLite migrates existing market.yml into the database.
storage:
  sqlite: true

# Price smoothing and volatility guards
price-smoothing:
  enabled: true
  # Exponential moving average factor (0.0-1.0). Higher = follow target faster.
  ema-alpha: 0.3
  # Max percent change allowed per tick (0 disables clamping)
  max-change-percent: 15.0

# Inventory-driven price influence (optional)
# If enabled, the average per-player stock (from online inventories) will influence prices.
price-inventory:
  enabled: true
  # Strength of inventory pressure per cycle (0.0-1.0 typical range 0.01-0.10)
  sensitivity: 0.02
  # Baseline units per online player; above this pushes price down, below pushes up
  per-player-baseline: 64
  # Limit inventory impact per cycle in percent to avoid shocks
  max-impact-percent: 10.0

## Initial seeding behavior (applies only if market.yml does not exist)
# When true, seed the market with ALL Materials (except AIR/LEGACY), respecting blacklist-items
seed-all-materials: false

# Transaction tax applied to buy/sell (percent)
transaction-tax-percent: 0.0

# If true, The Endex will add a curated set of important items to the market on first run (ignored if seed-all-materials = true)
include-default-important-items: true

# Items that must never be tracked by the market (names must match Bukkit Material names)
blacklist-items: []

# GUI
gui:
  # Show a tiny ASCII history chart in item details view
  details-chart: true

# Investments
# Use /market invest [buy|list|redeem-all]
investments:
  enabled: true
  # Default annual percentage rate for passive gains
  apr-percent: 5.0

# History export (for backups/analysis). CSV files per item will be written in plugins/TheEndex/history
history-export:
  enabled: true
  folder: history

# Resource tracking (detect gathered resources on the server)
tracking:
  resources:
    enabled: true
    # When true, update market supply immediately when resources are gathered
    apply-to-market: false
    # Event sources to listen for
    sources:
      block-break: true
      mob-drops: true
      fishing: true

# Events configuration
# Cap on stacked event multipliers (effective price multiplier will not exceed this value)
events:
  multiplier-cap: 10.0

# Web interface for stock market trading
web:
  enabled: true
  # Bind address for the web server (use 127.0.0.1 to restrict to local machine, or 0.0.0.0 to listen on all interfaces)
  host: 127.0.0.1
  port: 3434
  session-duration-hours: 2
  # Client polling interval in milliseconds (for REST polling UI)
  poll-ms: 1000
  # Default number of history points the web API returns
  history-limit: 120
  # Optional Server-Sent Events (SSE) live updates (advanced). If enabled, /api/sse is available.
  sse:
    enabled: false
  # Optional WebSocket live updates (recommended). If enabled, /api/ws is available.
  websocket:
    enabled: true
  # Simple per-session rate limiting for API endpoints
  rate-limit:
    enabled: true
    requests: 30
    per-seconds: 10
    # Exempt the built-in web UI from rate limiting to reduce visible 429s while keeping API protected
    exempt-ui: true

  # Roles and permissions for the web interface
  roles:
    # Default role when a player opens the web link (TRADER or VIEWER)
    default: TRADER
    # Players with this permission can trade via web (role elevated to TRADER)
    trader-permission: endex.web.trade
    # Players with this permission can view other players' holdings via /api/holdings/{uuid}
    admin-view-permission: endex.web.admin

  # Use actual Minecraft item/block icons in the web UI by extracting a resource pack
  icons:
    # Master toggle for icons in the web UI
    enabled: false
    # Where to get the resource pack from. Accepts:
    #  - Path to a .zip file (e.g., plugins/TheEndex/packs/vanilla.zip)
    #  - Path to a folder containing either a "textures" dir or "assets/minecraft/textures"
    #  - A direct URL to a .zip (http/https)
    # If blank and a previously extracted pack exists in plugins/TheEndex/resourcepack, that will be used.
    source: ""

  # Addons list for the web UI Addons tab (purely display/navigation for now)
  addons: []

  # Custom Web UI override (advanced)
  custom:
    enabled: false           # When true, serve files from plugins/TheEndex/webui instead of embedded UI
    root: webui               # Relative folder (inside plugin data folder) containing custom index.html
    reload: false             # When true, do not cache index.html (re-read each request for rapid iteration)
    export-default: true      # On startup, if enabled and index.html missing, export the built-in UI as a starting point

  # Inventory snapshot settings for web holdings (online-only; lightweight and cached)
  holdings:
    inventory:
      enabled: true
      # Include Ender Chest items in inventory counts
      include-enderchest: false
      # Cache duration for per-player snapshots (seconds)
      cache-seconds: 15

# Logging options
logging:
  verbose: false
